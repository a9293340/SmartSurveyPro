# SmartSurvey Pro - TODO 延後開發項目

> 📅 最後更新：2025-01-17
> 🎯 用途：追蹤已實作功能中因各種原因延後優化的部分 📋 狀態：🔄 延後中 |
> ✅ 已實作 | ❌ 已取消

---

## 📊 TODO 定義說明

### 兩種 TODO 類型：

#### 🚧 `TODO(human)` - 教學模式（不列入此文件）

- **定義**：框架已建立，核心邏輯標記供人類實作
- **狀態**：現在進行式，等待開發者實作
- **範例**：
  ```typescript
  // 在 auth.ts 中
  function isProtectedPath(path: string): boolean {
    // TODO(human): 實作路徑匹配邏輯
    // 學習重點：處理動態路由、正則表達式匹配
  }
  ```
- **管理方式**：不需要記錄在此文件，屬於正常開發流程

#### 🔄 `TODO(future)` - 延後開發項目（此文件追蹤）

- **定義**：功能已實作並可正常運作，但因特定原因延後優化
- **狀態**：基礎功能完成，等待未來升級
- **範例**：
  ```typescript
  // 在 rate-limit.ts 中
  // TODO(future): Rate Limit Redis 升級 [Phase 1 記憶體版本已足夠]
  const requestCounts = new Map(); // 目前使用記憶體，未來升級 Redis
  ```
- **管理方式**：記錄在此文件，按優先級排程

---

## 🔄 延後開發項目

### 來自 Task 1.2.2 - 中間件系統 ✅

#### 📈 Rate Limit Redis 升級

- **檔案位置**：`apps/web/server/middleware/02-rate-limit.ts:27`
- **當前狀態**：使用記憶體 Map 存儲，功能完整可用
- **延後原因**：Phase 1 單機部署記憶體版本已足夠 MVP 需求
- **預計實作**：Phase 2 考慮分散式部署時
- **影響程度**：低 - 單機部署記憶體版本足夠
- **實作內容**：
  ```typescript
  // 升級計劃
  - 整合 @upstash/ratelimit 套件
  - 真正的滑動窗口演算法
  - 分散式實例間共享限制數據
  - Redis 連接配置和容錯處理
  ```

#### 📈 專業日誌系統升級

- **檔案位置**：`apps/web/server/middleware/01-logger.ts:149-150`
- **當前狀態**：使用 console 輸出，功能完整可用
- **延後原因**：Phase 1 console 日誌已足夠開發和測試需求
- **預計實作**：Phase 2 生產環境準備時
- **影響程度**：低 - console 輸出已足夠開發階段使用
- **實作內容**：
  ```typescript
  // 升級計劃
  - 整合 Pino 或 Winston 專業日誌庫
  - 結構化日誌格式 (JSON)
  - 日誌聚合服務整合 (ELK Stack)
  - APM 工具整合 (New Relic/DataDog)
  - 日誌輪替和歸檔機制
  ```

### 來自 Task 2.2 - 認證 API 系統 🔄

#### 📈 me.get.ts Session 快取優化

- **檔案位置**：`apps/web/server/api/auth/me.get.ts`
- **當前狀態**：每次呼叫都查詢 MongoDB，功能完整可用
- **延後原因**：Phase 1 單機部署直接查詢資料庫可接受
- **預計實作**：Phase 2 引入 Redis 時
- **影響程度**：高 - 這是最頻繁呼叫的 API
- **實作內容**：
  ```typescript
  // TODO(future): Redis Session 快取
  // 升級計劃：
  - Session 快取 (TTL: 5分鐘)
  - 用戶資訊 + 群組權限一起快取
  - 快取失效策略（用戶資料更新時清除）
  - 減少 90% 資料庫查詢
  ```

#### 📈 Token 黑名單機制

- **檔案位置**：`apps/web/server/api/auth/logout.post.ts` & `refresh.post.ts`
- **當前狀態**：Token 撤銷功能待實作
- **延後原因**：Phase 1 無狀態 JWT 已足夠
- **預計實作**：Phase 2 安全性強化時
- **影響程度**：中 - 影響登出和 Token 刷新安全性
- **實作內容**：
  ```typescript
  // TODO(future): Token 撤銷機制
  // 升級計劃：
  - Redis Set 儲存已撤銷的 Token ID
  - Token Family 概念防止 Refresh Token 重用
  - 登出時立即撤銷所有相關 Token
  - 設定 TTL 自動清理過期項目
  ```

#### 📈 登入防護機制

- **檔案位置**：`apps/web/server/api/auth/login.post.ts`
- **當前狀態**：無登入失敗限制
- **延後原因**：Phase 1 開發測試階段不需要
- **預計實作**：Phase 2 生產環境準備時
- **影響程度**：中 - 防止暴力破解攻擊
- **實作內容**：
  ```typescript
  // TODO(future): 登入失敗計數與鎖定
  // 升級計劃：
  - Redis 計數器追蹤失敗次數
  - IP 基礎的速率限制
  - 帳號暫時鎖定機制（5次失敗鎖定15分鐘）
  - 併發登入設備數限制
  ```

#### 📈 註冊防護機制

- **檔案位置**：`apps/web/server/api/auth/register.post.ts`
- **當前狀態**：無註冊頻率限制
- **延後原因**：Phase 1 內部測試不需要
- **預計實作**：Phase 2 開放註冊時
- **影響程度**：低 - 防止惡意註冊
- **實作內容**：
  ```typescript
  // TODO(future): 註冊頻率限制
  // 升級計劃：
  - IP 註冊頻率限制（每IP每小時最多3個帳號）
  - Email 域名黑名單
  - 臨時郵箱檢測
  - CAPTCHA 整合（多次失敗後啟用）
  ```

#### 🏗️ Workspace 工作區架構（分段實作）

- **檔案位置**：`apps/web/server/api/auth/me.get.ts` & 相關認證系統
- **當前狀態**：全域權限模式，權限並集處理，容易造成用戶困惑
- **分段策略**：Phase 1 基礎架構 + Phase 2 完善重構，降低風險
- **影響程度**：高 - 關係到整個產品的使用體驗和安全性

##### Phase 1: Workspace 基礎架構 (Task 5)

- **預計實作**：Phase 1 最後階段（降低風險）
- **實作範圍**：基礎工作區選擇和資料隔離
- **實作內容**：
  ```typescript
  // Phase 1 基礎實作：
  - 工作區選擇器 UI 組件
  - 基礎的工作區切換 API
  - Session 中的當前工作區狀態
  - 基本的資料存取邊界控制
  // 目標：建立基礎架構，驗證可行性
  ```

##### Phase 2: Workspace 完善重構 (Task 10)

- **預計實作**：Phase 2 中期（基於 Phase 1 基礎）
- **實作範圍**：完整的工作區隔離和進階 UX
- **實作內容**：
  ```typescript
  // TODO(future): Workspace 完善重構 [Phase 2 架構重構] [詳見 roadmap 10.]
  // 升級計劃：
  - 完整的工作區權限隔離
  - 跨工作區資源存取控制
  - Redis 快取結構最佳化
  - 進階前端 UX（麵包屑、無縫切換）
  - 資料遷移工具和機制
  // 目標：提升用戶體驗，強化資料安全性，符合用戶心理模型
  ```

### 來自 Task 3 - Survey CRUD API 系統 🔄

#### 📈 Redis 快取系統整合

- **檔案位置**：所有 Survey API 端點
- **當前狀態**：直接查詢 MongoDB，功能完整可用
- **延後原因**：Phase 1 單機部署直接查詢資料庫可接受
- **預計實作**：Phase 2 效能優化時
- **影響程度**：高 - 影響問卷列表和內容讀取效能
- **實作內容**：
  ```typescript
  // TODO(feature): Redis 快取支援
  // 升級計劃：
  - 問卷列表篩選結果快取 (TTL: 10分鐘)
  - 問卷內容版本化快取 (TTL: 1小時)
  - 問卷更新時自動清除相關快取
  - 問卷刪除時清除相關快取
  ```

#### 📈 全文搜尋功能

- **檔案位置**：`apps/web/server/api/surveys/index.get.ts`
- **當前狀態**：簡單正則表達式搜尋標題和描述
- **延後原因**：Phase 1 基本搜尋已滿足 MVP 需求
- **預計實作**：Phase 2 用戶體驗優化時
- **影響程度**：中 - 提升問卷搜尋體驗
- **實作內容**：
  ```typescript
  // TODO(feature): 全文搜尋功能
  // 升級計劃：
  - MongoDB Atlas Search 或 Elasticsearch 整合
  - 支援問卷標題、描述、題目內容搜尋
  - 搜尋結果高亮顯示
  - 搜尋建議和自動完成
  ```

#### 📈 問卷範本系統

- **檔案位置**：`apps/web/server/api/surveys/index.post.ts`
- **當前狀態**：只能從空白建立問卷
- **延後原因**：Phase 1 專注基礎功能，範本屬於進階功能
- **預計實作**：Phase 2 用戶體驗提升時
- **影響程度**：中 - 提升問卷建立效率
- **實作內容**：
  ```typescript
  // TODO(feature): 問卷範本系統
  // 升級計劃：
  - 預設範本庫（滿意度調查、市場研究等）
  - 用戶自訂範本保存
  - 範本分類和搜尋
  - 從範本建立問卷 API
  ```

#### 📈 問卷標籤分類系統

- **檔案位置**：所有 Survey API 端點
- **當前狀態**：無分類功能，只能按狀態篩選
- **延後原因**：Phase 1 基礎 CRUD 已足夠
- **預計實作**：Phase 2 問卷管理優化時
- **影響程度**：中 - 提升問卷組織和管理體驗
- **實作內容**：
  ```typescript
  // TODO(feature): 問卷標籤系統
  // 升級計劃：
  -問卷標籤建立和管理 -
    標籤分類篩選功能 -
    標籤顏色和圖示自訂 -
    建立時設置分類標籤;
  ```

#### 📈 版本控制系統

- **檔案位置**：`apps/web/server/api/surveys/[id].put.ts`
- **當前狀態**：問卷更新會覆蓋原始內容
- **延後原因**：Phase 1 簡單更新已滿足基本需求
- **預計實作**：Phase 2 協作功能時
- **影響程度**：高 - 防止重要內容遺失，支援協作
- **實作內容**：
  ```typescript
  // TODO(feature): 版本控制系統
  // 升級計劃：
  - 保存問卷修改歷史記錄
  - 版本比較和回滾功能
  - 查詢特定版本的問卷
  - 版本分支和合併（多人協作）
  ```

#### 📈 垃圾桶恢復功能

- **檔案位置**：`apps/web/server/api/surveys/[id].delete.ts`
- **當前狀態**：軟刪除到 ARCHIVED 狀態，但無恢復機制
- **延後原因**：Phase 1 軟刪除已防止意外刪除
- **預計實作**：Phase 2 用戶體驗優化時
- **影響程度**：中 - 提升誤刪恢復體驗
- **實作內容**：
  ```typescript
  // TODO(feature): 垃圾桶功能
  // 升級計劃：
  - 已刪除問卷列表查看
  - 問卷恢復 API 和 UI
  - 批量恢復功能
  - 定期自動清理機制（30天後永久刪除）
  ```

#### 📈 批量操作支援

- **檔案位置**：`apps/web/server/api/surveys/[id].delete.ts` & 其他端點
- **當前狀態**：只支援單筆操作
- **延後原因**：Phase 1 單筆操作已滿足基本需求
- **預計實作**：Phase 2 用戶效率提升時
- **影響程度**：中 - 提升大量問卷管理效率
- **實作內容**：
  ```typescript
  // TODO(feature): 批量操作支援
  // 升級計劃：
  - 批量刪除多個問卷
  - 批量狀態變更（發布、暫停等）
  - 批量標籤設定
  - 批量匯出功能
  ```

#### 🏗️ Workspace 工作區整合

- **檔案位置**：所有 Survey API 端點
- **當前狀態**：使用 userId 作為 workspace，無真正工作區概念
- **延後原因**：依賴 Task 5 Workspace 基礎架構
- **預計實作**：Phase 2 協作功能時
- **影響程度**：高 - 團隊協作核心功能
- **實作內容**：
  ```typescript
  // TODO(feature): 工作區整合
  // 升級計劃：
  - 工作區權限驗證和存在性檢查
  - 支援 workspace 成員讀取/編輯權限
  - 工作區篩選支援多工作區問卷管理
  - workspace 管理員可刪除成員問卷
  - 跨工作區問卷移動功能
  ```

#### 📈 即時協作同步

- **檔案位置**：`apps/web/server/api/surveys/[id].put.ts`
- **當前狀態**：樂觀鎖定防止併發修改
- **延後原因**：Phase 1 單用戶編輯已足夠
- **預計實作**：Phase 3 即時協作功能
- **影響程度**：高 - 多人同時編輯體驗
- **實作內容**：
  ```typescript
  // TODO(feature): 即時協作同步
  // 升級計劃：
  - WebSocket 廣播問卷變更
  - 實時顯示其他用戶游標和編輯狀態
  - 衝突解決機制
  - 協作歷史記錄
  ```

#### 📈 真實訂閱限制檢查

- **檔案位置**：`apps/web/server/api/surveys/index.post.ts`
- **當前狀態**：固定 Free 方案限制（3個問卷）
- **延後原因**：Phase 1 只需要基礎限制演示
- **預計實作**：Phase 3 付費系統整合時
- **影響程度**：高 - 商業模式核心功能
- **實作內容**：
  ```typescript
  // TODO(feature): 真實訂閱限制檢查
  // 升級計劃：
  -整合付費方案限制系統 -
    動態方案規則配置 -
    用量統計和監控 -
    升級提示和引導流程;
  ```

---

## ✅ 已完成項目

_目前沒有已完成的延後項目_

---

## ❌ 已取消項目

_目前沒有已取消的延後項目_

---

## 📋 管理規範

### 新增延後項目 (`TODO(future)`)

1. **觸發時機**：實作功能時發現需要延後優化的部分
2. **判斷標準**：
   - ✅ 基礎功能已完成且可正常運作
   - ✅ 因合理原因（MVP 範圍、依賴、Phase 規劃）延後
   - ✅ 有明確的延後理由和預計實作時間
3. **記錄內容**：
   - 來源 Task 和檔案位置
   - 當前實作狀態描述
   - 具體延後原因
   - 預計實作時間點
   - 影響程度評估
   - 詳細升級計劃

4. **程式碼標記**：
   ```typescript
   // TODO(future): 功能描述 [延後原因] [詳見 /docs/TODO.md]
   ```

### 教學標記 (`TODO(human)`) - 不納入此文件

- **用途**：框架建立完成，標記供開發者實作的部分
- **特徵**：包含學習重點、實作提示
- **範例**：
  ```typescript
  // TODO(human): 實作功能邏輯
  // 學習重點：
  // - 重點1
  // - 重點2
  ```
- **管理**：屬於正常開發流程，完成後直接移除標記

### 完成延後項目

1. **實作完成**：按照升級計劃實作功能
2. **移除標記**：刪除程式碼中的 `TODO(future)` 註解
3. **更新狀態**：移至「✅ 已完成項目」區域
4. **記錄日期**：標註完成時間和實作內容

### 取消延後項目

1. **評估原因**：技術變更、需求變更、不再需要
2. **更新狀態**：移至「❌ 已取消項目」區域
3. **記錄原因**：說明取消的具體原因

---

## 📈 延後項目實作優先級

### 高優先級 (Phase 1 結束前)

- 無 (所有延後項目都是優化性質)

### 中優先級 (Phase 2 開始)

- **Workspace 工作區架構重構** (用戶體驗和安全性重大提升)
- **Redis 快取系統整合** (Survey API 效能大幅提升)
- **問卷版本控制系統** (防止內容遺失，支援協作)
- **me.get.ts Session 快取** (最高頻率 API，優先優化)
- **問卷範本系統** (提升用戶建立問卷效率)
- **垃圾桶恢復功能** (用戶體驗提升)
- Token 黑名單機制 (安全性考量)
- 專業日誌系統 (生產環境需要)
- 登入防護機制 (防止攻擊)

### 低優先級 (按需實作)

- **全文搜尋功能** (用戶體驗提升，但基本搜尋已足夠)
- **問卷標籤分類系統** (組織管理提升，但按狀態篩選已足夠)
- **批量操作支援** (效率提升，但單筆操作已足夠)
- **真實訂閱限制檢查** (Phase 3 商業化時才需要)
- **即時協作同步** (Phase 3 進階協作功能)
- Rate Limit Redis 升級 (分散式部署時才需要)
- 註冊防護機制 (開放註冊後才需要)

---

## 📊 延後原因分類

- 📈 **Phase 規劃**：功能超出當前 Phase 範圍
- 🎯 **MVP 優先**：當前版本不需要，屬於優化項目
- 🏗️ **依賴限制**：需要其他基礎設施支持
- 🔧 **技術債**：使用臨時方案，計劃重構

---

_此文件專門追蹤已實作但因合理原因延後優化的功能，與 TODO(human) 教學標記區分管理_
